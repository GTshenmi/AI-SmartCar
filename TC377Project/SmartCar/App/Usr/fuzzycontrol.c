#include "fuzzycontrol.h"
#include "include.h"
/*Servo Fuzzy Control*/
//float SEFF[7] = {-75.0,-50.0,-25.0,0.0,25.0,50.0,75.0};
//
//float SDFF[7] = {-20.0,-10.0,-5.0,0.0,5.0,10.0,20.0};
//
//float SUFF[13] = {-1.0,-0.8,-0.6,-0.4,-0.2,-0.1,0.0,0.1,0.2,0.4,0.6,0.8,1.0};
//
//sint32_t SFuzzyRule[7][7] =
//{
//        /*ec-----------------*/ /*e*/
//        {-6,-6,-6,-6,-5,-5,-4,},/*|*/
//        {-5,-5,-5,-4,-4,-3,-1,},/*|*/
//        {-4,-4,-3,-1, 0, 1, 2,},/*|*/
//        {-4,-3,-1, 0, 1, 3, 4,},/*|*/
//        {-2,-1, 0, 1, 3, 4, 4,},/*|*/
//        { 1, 3, 4, 4, 5, 5, 5,},/*|*/
//        { 4, 5, 5, 6, 6, 6, 6}, /*|*/
//};

float SEFF[7] = {-75.0,-50.0,-25.0,0.0,25.0,50.0,75.0};

float SDFF[7] = {-20.0,-10.0,-5.0,0.0,5.0,10.0,20.0};

//float SDFF[7] = {-40.0,-20.0,-10.0,0.0,10.0,20.0,40.0};

//float SUFF[13] = {-1.0,-0.8,-0.6,-0.4,-0.2,-0.1,0.0,0.1,0.2,0.4,0.6,0.8,1.0};
float SUFF[13] = {-1.0,-0.8,-0.6,-0.4,-0.16,-0.08,0.0,0.08,0.16,0.4,0.6,0.8,1.0};

//sint32_t LABMSFuzzyRule[7][7] =
//{
//                    {-6,-6,-6,-6,-5,-5,-4},
//                    {-6,-5,-5,-4,-3,-3,-2},//
//                    {-5,-4,-3,-2, 0, 2, 2},
//                    {-4,-3,-1, 0, 1, 3, 4},
//                    {-2,-2, 0, 2, 3, 4, 5},
//                    {2, 3, 3, 4, 5, 5, 6},//
//                    {4, 5, 5, 6, 6, 6, 6},
//};

sint32_t LABMSFuzzyRule[7][7] =
{
    {-6,-6,-6,-6,-4,-4,-3},
    {-6,-5,-5,-4,-3,-2,-1},
    {-5,-4,-3,-1, 0, 1, 2},
    {-4,-3,-1, 0, 1, 3, 4},
    {-2,-1, 0, 1, 3, 4, 5},
    {1, 2, 3, 4, 5, 5, 6},
    {3, 4, 4, 6, 6, 6, 6},
};

//sint32_t LABMSFuzzyRule[7][7] =
//{
//                    {-6,-6,-6,-5,-4,-4,-3},
//                    {-5,-5,-4,-4,-3,-2,-1},//
//                    {-5,-3,-2,-1, 0, 1, 2},
//                    {-4,-3,-1, 0, 1, 3, 4},
//                    {-2,-1, 0, 1, 2, 3, 5},
//                    {1, 2, 3, 4, 4, 5, 5},//
//                    {3, 4, 4, 5, 6, 6, 6},
//};

sint32_t SABMSFuzzyRule[7][7] =
{
                    {-6,-6,-6,-6,-5,-5,-4},
                    {-6,-5,-5,-4,-3,-3,-2},//
                    {-6,-4,-2,-1, 0, 1, 2},
                    {-5,-3,-1, 0, 1, 3, 5},
                    {-2,-1, 0, 1, 2, 4, 6},
                    {2, 3, 3, 4, 5, 5, 6},//
                    {4, 5, 5, 6, 6, 6, 6},
};

sint32_t SFuzzyRule[7][7];

//sint32_t SFuzzyRule[7][7] =
//{
//                    {-6,-6,-6,-6,-5,-5,-4},
//                    {-6,-5,-5,-4,-3,-3,-2},//
//                    {-5,-4,-3,-1, 0, 1, 2},
//                    {-4,-3,-1, 0, 1, 3, 4},
//                    {-2,-1, 0, 1, 3, 4, 5},
//                    {2, 3, 3, 4, 5, 5, 6},//
//                    {4, 5, 5, 6, 6, 6, 6},
//};

//SEFF = {-75.0,-50.0,-25.0,0.0,25.0,50.0,75.0};
//
//SDFF = [-15,-10.0,-5.0,0.0,5.0,10.0,15.0];
//
//SUFF = [-0.8,-0.6,-0.4,-0.3,-0.2,-0.1,0.0,0.1,0.2,0.3,0.4,0.6,0.8];
//
//            %--------EC---------
//SFuzzyRule ={
//            {-6,-6,-6,-6,-5,-4,-3},%e
//            {-6,-5,-4,-3,-3,-2,-1},% |
//            {-5,-4,-3,-1, 0, 1, 2},% |
//            {-4,-3,-1, 0, 1, 3, 4},
//            {-2,-1, 0, 1, 3, 4, 5},
//            {1, 2, 3, 3, 4, 5, 6},
//            {3, 4, 5, 6, 6, 6, 6]}},

float FuzzyControl(Fuzzy_TypeDef *fuzzy, float target, float actual)
{
    float EF[2] = { 0.0,0.0 }, DF[2] = {0.0,0.0};

    int i = 0;

    int En = 0, Dn = 0;

    sint32_t Un[4];

    float UF[4];

    float U[13];

    for (i = 0; i < 13; i++)
    {
        U[i] = 0.0;
    }

    /*Calculate E and Ec.*/

    fuzzy->e[0] = fuzzy->e[1];
    fuzzy->e[1] = target - actual;

    fuzzy->ec = fuzzy->e[1] - fuzzy->e[0];

    /*Calculate Membership.*/

    if (fuzzy->e[1] < SEFF[0])
    {
        EF[0] = 1.0;
        EF[1] = 0.0;

        En = -3;
    }
    else if (fuzzy->e[1] >= SEFF[6])
    {
        EF[0] = 0.0;
        EF[1] = 1.0;
        //En = 3;
        En = 2;
    }
    else
    {
        for (i = 1; i <= 6; i++)
        {
            if ((fuzzy->e[1] < SEFF[i]) && (fuzzy->e[1] >= SEFF[i - 1])) //ÓÐ2Ìõ¹æÔòÉúÐ§
            {
                En = i - 1 - 3;

                EF[0] = -(fuzzy->e[1] - SEFF[i]) / (SEFF[i] - SEFF[i - 1]);

                EF[1] = (fuzzy->e[1] - SEFF[i - 1]) / (SEFF[i] - SEFF[i - 1]);
            }
        }
    }

    if (fuzzy->ec < SDFF[0])
    {
        DF[0] = 1.0;
        DF[1] = 0.0;

        Dn = -3;
    }
    else if (fuzzy->ec >= SDFF[6])
    {
        DF[0] = 0.0;
        DF[1] = 1.0;
        //Dn = 3;
        Dn = 2;
    }
    else
    {
        for (i = 1; i <= 6; i++)
        {
            if (fuzzy->ec < SDFF[i] && fuzzy->ec >= SDFF[i - 1]) //ÓÐ2Ìõ¹æÔòÉúÐ§
            {
                Dn = i - 1 - 3;

                DF[0] = -(fuzzy->ec - SDFF[i]) / (SDFF[i] - SDFF[i - 1]);

                DF[1] = (fuzzy->ec - SDFF[i - 1]) / (SDFF[i] - SDFF[i - 1]);
            }
        }
    }

    /*Fuzzy Reasoning.*/

    Un[0] = SFuzzyRule[En + 3][Dn + 3] + 6;      //2*2 = 4Ìõ¹æÔòÉúÐ§

    UF[0] = min(EF[0], DF[0]);

    Un[1] = SFuzzyRule[En + 3 + 1][Dn + 3] + 6;
    UF[1] = min(EF[1], DF[0]);

    Un[2] = SFuzzyRule[En + 3][Dn + 3 + 1] + 6;
    UF[2] = 1.0 * min(EF[0], DF[1]);

    Un[3] = SFuzzyRule[En + 3 + 1][Dn + 3 + 1] + 6;
    UF[3] = 1.0 * min(EF[1], DF[1]);

    if (Un[0] == Un[1])    //Í¬Á¥Êô¶ÈÓïÑÔÈ¡´ó
    {
        if (UF[0] > UF[1])
            UF[1] = 0;
        else
            UF[0] = 0;
    }
    if (Un[0] == Un[2])
    {
        if (UF[0] > UF[2])
            UF[2] = 0;
        else
            UF[0] = 0;
    }
    if (Un[0] == Un[3])
    {
        if (UF[0] > UF[3])
            UF[3] = 0;
        else
            UF[0] = 0;
    }

    if (Un[1] == Un[2])
    {
        if (UF[1] > UF[2])
            UF[2] = 0;
        else
            UF[1] = 0;
    }
    if (Un[1] == Un[3])
    {
        if (UF[1] > UF[3])
            UF[3] = 0;
        else
            UF[1] = 0;
    }

    if (Un[2] == Un[3])
    {
        if (UF[2] > UF[3])
            UF[3] = 0;
        else
            UF[2] = 0;
    }

    for (i = 0; i < 4; i++)
    {
        U[Un[i]] += UF[i];
    }

    /*Anti Fuzzy(Gravity Method)*/

    float sum0 = 0.0;
    float sum1 = 0.0;

    for (i = 0; i < 13; i++)
    {
        sum0 += U[i] * SUFF[i];

        sum1 += U[i];
    }

    if (fabs(sum1) < 1e-6)
        fuzzy->U = 0.0;
    else
        fuzzy->U = sum0 / sum1;

    return fuzzy->U;
}

//float FuzzySpeedTable[13][13] =
//{
//        {1326,1450,1450,1450,1650,1650,1700,1700,1678,1427,1427,1427,1427,},
//        {1424,1600,1600,1600,1818,1818,1857,1857,1804,1723,1723,1723,1661,},
//        {1424,1600,1600,1600,1818,1818,1857,1857,1804,1723,1723,1723,1661,},
//        {1424,1600,1600,1600,1818,1818,1857,1857,1804,1723,1723,1723,1661,},
//        {1518,1818,1818,1818,1964,1964,2135,2135,1973,1805,1805,1805,1735,},
//        {1518,1818,1818,1818,1964,1964,2135,2135,1973,1805,1805,1805,1735,},
//        {1553,2029,2029,2029,2268,2268,2350,2350,2300,1963,1963,1963,1535,},
//        {1553,2029,2029,2029,2268,2268,2350,2350,2300,1963,1963,1963,1535,},
//        {1735,1843,1843,1843,2030,2030,2200,2200,1980,1780,1780,1780,1533,},
//        {1650,1711,1711,1711,1780,1780,1827,1827,1791,1500,1500,1500,1400,},
//        {1650,1711,1711,1711,1780,1780,1827,1827,1791,1500,1500,1500,1400,},
//        {1650,1711,1711,1711,1780,1780,1827,1827,1791,1500,1500,1500,1400,},
//        {1450,1450,1450,1450,1650,1650,1700,1700,1678,1400,1400,1400,1333,},
//};

//float FuzzySpeedTable[13][13] =
//{
//        {2013,2075,2075,2075,2175,2175,2200,2200,2189,2063,2063,2063,2063,},
//        {2062,2240,2240,2240,2323,2323,2300,2300,2220,2181,2181,2181,2181,},
//        {2062,2240,2240,2240,2323,2323,2300,2300,2220,2181,2181,2181,2181,},
//        {2062,2240,2240,2240,2323,2323,2300,2300,2220,2181,2181,2181,2181,},
//        {2115,2324,2324,2324,2674,2674,2373,2373,2295,2295,2295,2295,2224,},
//        {2115,2324,2324,2324,2674,2674,2373,2373,2295,2295,2295,2295,2224,},
//        {2135,2436,2436,2436,2771,2771,2760,2760,2828,2374,2374,2374,2124,},
//        {2135,2436,2436,2436,2771,2771,2760,2760,2828,2374,2374,2374,2124,},
//        {2224,2295,2295,2295,2311,2311,2405,2405,2724,2280,2280,2280,2122,},
//        {2175,2175,2175,2175,2211,2211,2295,2295,2282,2182,2182,2182,2050,},
//        {2175,2175,2175,2175,2211,2211,2295,2295,2282,2182,2182,2182,2050,},
//        {2175,2175,2175,2175,2211,2211,2295,2295,2282,2182,2182,2182,2050,},
//        {2075,2075,2075,2075,2175,2175,2200,2200,2189,2050,2050,2050,2017,},
//};


float FuzzySpeedTable[13][13] =
{
        {2013,2112,2112,2112,2263,2263,2300,2300,2283,2093,2093,2093,2093,},
        {2093,2340,2340,2340,2473,2473,2455,2455,2340,2271,2271,2271,2271,},
        {2093,2340,2340,2340,2473,2473,2455,2455,2340,2271,2271,2271,2271,},
        {2093,2340,2340,2340,2473,2473,2455,2455,2340,2271,2271,2271,2271,},
        {2185,2471,2471,2471,2900,2900,2600,2600,2443,2442,2442,2442,2347,},
        {2185,2471,2471,2471,2900,2900,2600,2600,2443,2442,2442,2442,2347,},
        {2221,2688,2688,2688,3048,3048,3010,3010,3100,2605,2605,2605,2200,},
        {2221,2688,2688,2688,3048,3048,3010,3010,3100,2605,2605,2605,2200,},
        {2347,2442,2442,2442,2467,2467,2657,2657,2962,2420,2420,2420,2194,},
        {2263,2263,2263,2263,2328,2328,2443,2443,2423,2265,2265,2265,2071,},
        {2263,2263,2263,2263,2328,2328,2443,2443,2423,2265,2265,2265,2071,},
        {2263,2263,2263,2263,2328,2328,2443,2443,2423,2265,2265,2265,2071,},
        {2112,2112,2112,2112,2263,2263,2300,2300,2283,2071,2071,2071,2017,},

//        {2013,2075,2075,2075,2175,2175,2200,2200,2189,2063,2063,2063,2063,},
//        {2062,2230,2230,2230,2318,2318,2309,2309,2230,2181,2181,2181,2181,},
//        {2062,2230,2230,2230,2318,2318,2309,2309,2230,2181,2181,2181,2181,},
//        {2062,2230,2230,2230,2318,2318,2309,2309,2230,2181,2181,2181,2181,},
//        {2127,2319,2319,2319,2604,2604,2418,2418,2300,2300,2300,2300,2235,},
//        {2127,2319,2319,2319,2604,2604,2418,2418,2300,2300,2300,2300,2235,},
//        {2153,2479,2479,2479,2705,2705,2680,2680,2739,2426,2426,2426,2141,},
//        {2153,2479,2479,2479,2705,2705,2680,2680,2739,2426,2426,2426,2141,},
//        {2235,2300,2300,2300,2317,2317,2457,2457,2648,2285,2285,2285,2133,},
//        {2175,2175,2175,2175,2222,2222,2300,2300,2286,2182,2182,2182,2050,},
//        {2175,2175,2175,2175,2222,2222,2300,2300,2286,2182,2182,2182,2050,},
//        {2175,2175,2175,2175,2222,2222,2300,2300,2286,2182,2182,2182,2050,},
//        {2075,2075,2075,2075,2175,2175,2200,2200,2189,2050,2050,2050,2017,},
//
//        {2013,2075,2075,2075,2175,2175,2200,2200,2189,2063,2063,2063,2063,},
//        {2062,2310,2310,2310,2400,2400,2377,2377,2255,2181,2181,2181,2181,},
//        {2062,2310,2310,2310,2400,2400,2377,2377,2255,2181,2181,2181,2181,},
//        {2062,2310,2310,2310,2400,2400,2377,2377,2255,2181,2181,2181,2181,},
//        {2158,2405,2405,2405,2865,2865,2559,2559,2362,2368,2368,2368,2265,},
//        {2158,2405,2405,2405,2865,2865,2559,2559,2362,2368,2368,2368,2265,},
//        {2197,2664,2664,2664,3014,3014,2980,2980,3072,2589,2589,2589,2182,},
//        {2197,2664,2664,2664,3014,3014,2980,2980,3072,2589,2589,2589,2182,},
//        {2265,2368,2368,2368,2389,2389,2619,2619,2933,2350,2350,2350,2161,},
//        {2175,2175,2175,2175,2250,2250,2362,2362,2345,2247,2247,2247,2050,},
//        {2175,2175,2175,2175,2250,2250,2362,2362,2345,2247,2247,2247,2050,},
//        {2175,2175,2175,2175,2250,2250,2362,2362,2345,2247,2247,2247,2050,},
//        {2075,2075,2075,2075,2175,2175,2200,2200,2189,2050,2050,2050,2017,},
//
//        {2062,2310,2310,2310,2432,2432,2423,2423,2310,2232,2232,2232,2232,},
//        {2062,2310,2310,2310,2432,2432,2423,2423,2310,2232,2232,2232,2232,},
//        {2062,2310,2310,2310,2432,2432,2423,2423,2310,2232,2232,2232,2232,},
//        {2158,2405,2405,2405,2896,2896,2714,2714,2414,2426,2426,2426,2329,},
//        {2158,2405,2405,2405,2896,2896,2714,2714,2414,2426,2426,2426,2329,},
//        {2197,2664,2664,2664,3048,3048,3015,3015,3111,2768,2768,2768,2241,},
//        {2197,2664,2664,2664,3048,3048,3015,3015,3111,2768,2768,2768,2241,},
//        {2265,2368,2368,2368,2389,2389,2638,2638,2967,2405,2405,2405,2222,},
//        {2175,2175,2175,2175,2250,2250,2381,2381,2382,2271,2271,2271,2079,},
//        {2175,2175,2175,2175,2250,2250,2381,2381,2382,2271,2271,2271,2079,},
//        {2175,2175,2175,2175,2250,2250,2381,2381,2382,2271,2271,2271,2079,},
//        {2075,2075,2075,2075,2175,2175,2224,2224,2233,2079,2079,2079,2017,},
};
//float FuzzySpeedTable[13][13] =
//{
//        {1826,1950,1950,1950,2150,2150,2200,2200,2178,1927,1927,1927,1927,},
//        {1924,2100,2100,2100,2318,2318,2357,2357,2304,2223,2223,2223,2161,},
//        {1924,2100,2100,2100,2318,2318,2357,2357,2304,2223,2223,2223,2161,},
//        {1924,2100,2100,2100,2318,2318,2357,2357,2304,2223,2223,2223,2161,},
//        {2018,2318,2318,2318,2464,2464,2635,2635,2473,2305,2305,2305,2235,},
//        {2018,2318,2318,2318,2464,2464,2635,2635,2473,2305,2305,2305,2235,},
//        {2053,2529,2529,2529,2768,2768,2850,2850,2800,2463,2463,2463,2035,},
//        {2053,2529,2529,2529,2768,2768,2850,2850,2800,2463,2463,2463,2035,},
//        {2235,2343,2343,2343,2530,2530,2700,2700,2480,2280,2280,2280,2033,},
//        {2150,2211,2211,2211,2280,2280,2327,2327,2291,2000,2000,2000,1900,},
//        {2150,2211,2211,2211,2280,2280,2327,2327,2291,2000,2000,2000,1900,},
//        {2150,2211,2211,2211,2280,2280,2327,2327,2291,2000,2000,2000,1900,},
//        {1950,1950,1950,1950,2150,2150,2200,2200,2178,1900,1900,1900,1833,},
//};


//float FuzzySpeedTable[13][13] =
//{
//        {2026,2150,2150,2150,2350,2350,2400,2400,2378,2127,2127,2127,2127,},
//        {2124,2340,2340,2340,2518,2518,2527,2527,2430,2361,2361,2361,2361,},
//        {2124,2340,2340,2340,2518,2518,2527,2527,2430,2361,2361,2361,2361,},
//        {2124,2340,2340,2340,2518,2518,2527,2527,2430,2361,2361,2361,2361,},
//        {2218,2514,2514,2514,2809,2809,2673,2673,2514,2505,2505,2505,2435,},
//        {2218,2514,2514,2514,2809,2809,2673,2673,2514,2505,2505,2505,2435,},
//        {2253,2729,2729,2729,2943,2943,2900,2900,2967,2663,2663,2663,2235,},
//        {2253,2729,2729,2729,2943,2943,2900,2900,2967,2663,2663,2663,2235,},
//        {2435,2505,2505,2505,2533,2533,2724,2724,2857,2480,2480,2480,2233,},
//        {2350,2350,2350,2350,2411,2411,2514,2514,2491,2271,2271,2271,2100,},
//        {2350,2350,2350,2350,2411,2411,2514,2514,2491,2271,2271,2271,2100,},
//        {2350,2350,2350,2350,2411,2411,2514,2514,2491,2271,2271,2271,2100,},
//        {2150,2150,2150,2150,2350,2350,2400,2400,2378,2100,2100,2100,2033,},
//};

sint32_t MFuzzyRule[7][7] =
{
        {-6,-6,-6,-5,-4,-4,-3},
        {-5,-5,-4,-4,-3,-2,-1},//
        {-5,-3,-2,-1, 0, 1, 2},
        {-4,-3,-1, 0, 1, 3, 4},
        {-2,-1, 0, 1, 2, 3, 5},
        {1, 2, 3, 4, 4, 5, 5},//
        {3, 4, 4, 5, 6, 6, 6},
};

float MEFF[7] = {-75.0,-50.0,-25.0,0.0,25.0,50.0,75.0};

float MDFF[7] = {-40.0,-20.0,-10.0,0.0,10.0,20.0,40.0};

float MUFF[13] = { 2000,2200,2400,2600,2800,3000,3200,3000,2800,2600,2400,2200,2000 };

float FuzzySpeedControl(Fuzzy_TypeDef *fuzzy,float target,float actual)
{
    float EFF[13] = {-90.0,-80.0,-70.0,-60.0,-30.0,-20.0,0.0,20.0,30.0,60.0,70.0,80.0,90.0};

    float DFF[13] = {-60.0,-45.0,-30.0,-20.0,-10.0,-5.0,0.0,5.0,10.0,20.0,30.0,45.0,60.0};

    int En = 0, Dn = 0;

    float E = 0.0,D = 0.0;
    float targerSpeed;
    float ke = 14.286,kec = 6.67;

    float e = fuzzy->e[1];
    float ec = fuzzy->ec;

    if (e < EFF[0])
    {
        E = -6;
    }
    else if (e >= EFF[6])
    {
        E = 6;
    }
    else
    {
        for (int i = 1; i <= 13; i++)
        {
            if ((e < EFF[i]) && (e >= EFF[i - 1]))
            {
                E = i - 1 - 6 + (e - EFF[i - 1])/(EFF[i] - EFF[i - 1]);
            }
        }
    }

    if (ec < DFF[0])
    {
        D = -6;
    }
    else if (ec >= DFF[6])
    {
        D = 6;
    }
    else
    {
        for (int i = 1; i <= 13; i++)
        {
            if ((ec < DFF[i]) && (ec >= DFF[i - 1]))
            {
                D = i - 1 - 6 + (e - DFF[i - 1])/(DFF[i] - DFF[i - 1]);
            }
        }
    }

    if (E > 0) {

        En = (int)(e / ke + 0.5);
    }
    else {

        En = (int)(e / ke - 0.5);
    }

    if (D > 0) {

        Dn = (int)(ec / kec + 0.5);
    }
    else {
        Dn = (int)(ec / kec - 0.5);
    }

    //En = 0,Dn = 0;

    if (En > 6)
        En = 6;
    else if (En < -6)
        En = -6;

    if (Dn > 6)
        Dn = 6;
    else if (Dn < -6)
        Dn = -6;

    targerSpeed = (FuzzySpeedTable[En + 6][Dn + 6]);

    return targerSpeed;

}

/*Motor Fuzzy Control*/
float MEFF_Kp[7] = {-30.0,-20.0,-10.0,0.0,10.0,20.0,30.0};
float MDFF_Kp[7] = {-30.0,-20.0,-10.0,0.0,10.0,20.0,30.0};
float MUFF_Kp[7] = {-0.3,-0.2,-0.1,0,0.1,0.2,0.3};

sint32_t MFuzzyRule_Kp[7][7] = 
{
     /*Ec*/
  {3,3,3,3,3,3,3}, /*E*/
  {3,3,3,3,3,2,2},
  {2,2,2,2,2,1,1},
  {1,1,1,0,1,1,1},
  {0,1,2,2,2,2,2},/*E = 1*/
  {3,3,3,3,3,3,3},/*E = 2*/
  {3,3,3,3,3,3,3},/*E = 3*/
};
//
//float MEFF_Ki[7] = {-75.0,-50.0,-25.0,0.0,25.0,50.0,75.0};
//float MDFF_Ki[7] = {-20.0,-10.0,-5.0,0.0,5.0,10.0,20.0};
//float MUFF_Ki[7] = {-0.2,-0.1,-0.05,0,0.05,0.1,0.2};

float MEFF_Ki[7] = {-30.0,-20.0,-10.0,0.0,10.0,20.0,30.0};
float MDFF_Ki[7] = {-30.0,-20.0,-10.0,0.0,10.0,20.0,30.0};
float MUFF_Ki[7] = {-0.8,-0.4,-0.2,0,0.2,0.4,0.8};

sint32_t MFuzzyRule_Ki[7][7] = 
{
    {-3,-3,-2,-2,-1,0,0},
    {-3,-3,-2,-1,-1,0,0},
    {-3,-2,-1,-1,0,1,1},
    {-2,-2,-1,0,1,2,2},
    {-2,-1,0,1,1,2,3},
    {0,0,1,1,2,3,3},
    {0,0,1,2,2,3,3},
};

float MUBuf_Kp[7];
float MUBuf_Ki[7];

float FuzzyPIDInit(Fuzzy_TypeDef *pFuzzy,Fuzzy_TypeDef *iFuzzy)
{
    fuzzy_init_t fuzzyInitStr;

    fuzzyInitStr.DFF = MDFF_Kp;
    fuzzyInitStr.DFFLen = 7;
    fuzzyInitStr.EFF = MEFF_Kp;
    fuzzyInitStr.EFFLen = 7;
    fuzzyInitStr.UBuf = MUBuf_Kp;
    fuzzyInitStr.UFF = MUFF_Kp;
    fuzzyInitStr.UFFLen = 7;
    fuzzyInitStr.Rule = &MFuzzyRule_Kp[0][0];

    FuzzyInit(pFuzzy,&fuzzyInitStr);

    fuzzyInitStr.DFF = MDFF_Ki;
    fuzzyInitStr.DFFLen = 7;
    fuzzyInitStr.EFF = MEFF_Ki;
    fuzzyInitStr.EFFLen = 7;
    fuzzyInitStr.UBuf = MUBuf_Ki;
    fuzzyInitStr.UFF = MUFF_Ki;
    fuzzyInitStr.UFFLen = 7;
    fuzzyInitStr.Rule = &MFuzzyRule_Ki[0][0];

    FuzzyInit(iFuzzy,&fuzzyInitStr);

    return 0.0;
}

float FuzzyPIDCtrl(Fuzzy_TypeDef *pFuzzy,Fuzzy_TypeDef *iFuzzy,float target,float actual)
{
    FuzzyCtrl(pFuzzy,target,actual);
    FuzzyCtrl(iFuzzy,target,actual);
    return 0.0;
}
